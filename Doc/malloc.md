# 内存分配（堆）

## 源码

- Src/malloc.c
- Src/new_delete.cpp

## 主要功能

### 堆初始化`nano_crt_init_heap()`

- Windows下采用`VirtualAlloc()`直接申请空间，Linux下使用`brk()`将数据段结束地址向后调整从而得到一块空间

### 堆的分配`malloc()`

- 采用空闲链表算法进行分配

### 堆的释放`free()`

- 采用空闲链表法，若释放后可合并则会进行空闲块的合并

### 支持C++的new/delete操作

- 支持申请、释放对象及对象数组，只负责申请、释放堆空间，不负责构造和析构

## 待做功能

- 堆初始化目前固定为32M堆空间，后续调整为动态堆空间
- 目前采用空闲链表算法作为堆空间分配算法，后续可以参考`tcmalloc`、`ptmalloc`、`jemalloc`进行优化，优化方向包括
    - 搜索速度优化
    - 空间分配优化，减小碎片的存在
- 多线程支持
- new/delete失败的异常处理机制

